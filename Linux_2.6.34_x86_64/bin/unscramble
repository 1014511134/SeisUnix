#!/bin/sh
# Shell:  unscramble
# based on a shell script called 'unattach' by Barb Dyker of rmNUG	
#        modified by John Stockwell 12 Dec 1990
# usage: unscramble FILENAME

name=`basename $0`
if [ $# != 1 ]; then
    echo "Usage: $name filename"
    exit 1
fi

#
# Setup working environment
#
FILENAME=$1
USERNAME=`whoami`
DIR="$HOME/Unscrambled"

if [ ! -d $DIR ]; then
    mkdir $DIR
    chmod 700 $DIR
fi
mv $FILENAME $DIR
cd $DIR
TMPFILE=tmpmsg

#
# Deal with file
#

if [ -r $FILENAME ]; then
    ATTACH=`awk '/^begin [0-9]/ {print $3}' $FILENAME`		    #get name
	echo "Unscrambling $FILENAME, please standby"
    uudecode $FILENAME						    #uudecode
    chmod 0600 $ATTACH
    mv $ATTACH ${TMPFILE}.Z
    uncompress ${TMPFILE}.Z					    #uncompress
    tar -tf $TMPFILE > toc$ATTACH
    tar -xf $TMPFILE						    #untar
	echo "The decoded files are in ~$USERNAME/Unscrambled"
	echo
	echo "The decoded files are:"
    for FILE in `cat toc$ATTACH`
    do
	echo "~$USERNAME/Unscrambled/$FILE"
    done
    rm $TMPFILE
else
    echo "$name: Sorry, could not open $FILENAME."
    exit 1
fi
exit 0
